<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>To-Do List with Categories & Priority Sort</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 10px;
      display: flex;
      gap: 20px;
    }
    #main {
      flex: 1;
    }
    h1 {
      text-align: center;
    }
    .task {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      margin: 4px 0;
      background: #fff;
      border-radius: 5px;
    }
    .high {
      border-left: 5px solid red;
    }
    .medium {
      border-left: 5px solid orange;
    }
    .low {
      border-left: 5px solid green;
    }
    select,
    input,
    button {
      padding: 5px;
      font-size: 16px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    #categoryList {
      width: 200px;
      background: white;
      padding: 10px;
      border-radius: 5px;
      height: fit-content;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    #categoryList h3 {
      margin-top: 0;
      text-align: center;
    }
    #categoryList button {
      width: 100%;
      margin: 5px 0;
      text-align: left;
      background: #eee;
      color: #333;
    }
    #categoryList button.active {
      background: #007bff;
      color: white;
    }
  </style>
</head>
<body>
  <div id="main">
    <h1>üìã To-Do List</h1>

    <div>
      <input id="taskInput" type="text" placeholder="Task" />
      <input id="categoryInput" type="text" placeholder="Category" />
      <select id="priorityInput">
        <option value="high">High</option>
        <option value="medium" selected>Medium</option>
        <option value="low">Low</option>
      </select>
      <button onclick="addTask()">Add</button>
    </div>

    <div id="taskList"></div>
  </div>

  <div id="categoryList">
    <h3>Categories</h3>
    <button class="active" onclick="filterCategory('')">Show All</button>
    <!-- Categories inserted here dynamically -->
  </div>

  <script>
    let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
    let currentCategory = "";

    function priorityValue(priority) {
      // For sorting: High = 1, Medium = 2, Low = 3
      if (priority === "high") return 1;
      if (priority === "medium") return 2;
      if (priority === "low") return 3;
      return 4; // default lowest
    }

    function addTask() {
      let text = document.getElementById("taskInput").value.trim();
      let category = document.getElementById("categoryInput").value.trim();
      let priority = document.getElementById("priorityInput").value;
      if (text) {
        tasks.push({ text, category, priority });
        localStorage.setItem("tasks", JSON.stringify(tasks));
        document.getElementById("taskInput").value = "";
        document.getElementById("categoryInput").value = "";
        currentCategory = ""; // reset filter after adding
        renderTasks();
        renderCategories();
      }
    }

    function removeTask(index) {
      tasks.splice(index, 1);
      localStorage.setItem("tasks", JSON.stringify(tasks));
      renderTasks();
      renderCategories();
    }

    function filterCategory(category) {
      currentCategory = category;
      // Highlight active button
      const buttons = document.querySelectorAll("#categoryList button");
      buttons.forEach((btn) => {
        btn.classList.toggle("active", btn.textContent === (category || "Show All"));
      });
      renderTasks();
    }

    function renderTasks() {
      let list = document.getElementById("taskList");
      list.innerHTML = "";

      // Filter tasks by category if needed
      let filteredTasks = currentCategory
        ? tasks.filter((t) => t.category.toLowerCase() === currentCategory.toLowerCase())
        : tasks;

      // Sort by priority: high > medium > low
      filteredTasks.sort((a, b) => priorityValue(a.priority) - priorityValue(b.priority));

      filteredTasks.forEach((task, i) => {
        let div = document.createElement("div");
        div.className = `task ${task.priority}`;
        div.innerHTML = `<div>
          <strong>${task.text}</strong> <em>(${task.category})</em>
        </div>
        <button onclick="removeTask(${tasks.indexOf(task)})">‚ùå</button>`;
        list.appendChild(div);
      });

      if(filteredTasks.length === 0) {
        list.innerHTML = "<p>No tasks in this category.</p>";
      }
    }

    function renderCategories() {
      let catDiv = document.getElementById("categoryList");

      // Get unique categories from tasks
      let categories = [...new Set(tasks.map((t) => t.category).filter((c) => c.trim() !== ""))];

      // Remove old category buttons except "Show All"
      const oldButtons = Array.from(catDiv.querySelectorAll("button")).filter(
        (btn) => btn.textContent !== "Show All"
      );
      oldButtons.forEach((btn) => btn.remove());

      // Add buttons for each category
      categories.forEach((cat) => {
        let btn = document.createElement("button");
        btn.textContent = cat;
        if (cat.toLowerCase() === currentCategory.toLowerCase()) btn.classList.add("active");
        btn.onclick = () => filterCategory(cat);
        catDiv.appendChild(btn);
      });
    }

    // Initial render
    renderTasks();
    renderCategories();
  </script>
</body>
</html>